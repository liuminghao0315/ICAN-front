# 【全模态智能事件流】使用指南

## 🎯 核心概念

### 唯一证据数据库
所有视频分析证据统一存储在 `timelineEvents` 数组中，这是整个分析系统的**唯一真实来源**。

### 三种模态卡片

| 模态 | 图标 | 用途 | 示例 |
|------|------|------|------|
| **Speech** | 🎤 麦克风 | 语音转文字 + 情绪 | "我是北大学生..." |
| **Visual** | 👁️ 眼睛 | 画面风险检测 | 检测到校徽、敏感文字 |
| **AudioEffect** | 🎧 耳机 | 非语言声音 | 拍桌、咆哮、尖叫 |

---

## 🚀 快速开始

### 1. 启动开发环境
```bash
cd d:\360MoveData\Users\23793\Desktop\ican\开发\frontend
cnpm run dev
```

### 2. 访问分析页面
打开浏览器访问：`http://localhost:5173/analysis`

### 3. 选择视频
点击右上角"选择视频" → 选择"北大学生吐槽选课系统"

### 4. 查看事件流
右侧面板显示17个事件卡片，涵盖整个视频50秒时长。

---

## 📊 界面布局

```
┌─────────────────────────────────────────────────────────┐
│  📊 分析结果                     [交互分析] [报告视图]  │
├─────────────────────────────────────────────────────────┤
│  🎬 视频档案卡（6个核心指标）                            │
├─────────────┬───────────────────────────────────────────┤
│             │  🎛️ 筛选器: [全模态] [风险优先] [纯字幕]  │
│   📹 视频    │                                           │
│   播放器    │  📜 事件流列表（按时间排序）                │
│             │   ┌─────────────────────────────────┐    │
│   🎯 检测框  │   │ 🎤 [0:05-0:10] Speech 低风险    │    │
│   实时显示  │   │    大家好，我是...               │    │
│             │   ├─────────────────────────────────┤    │
│   📈 时间轴  │   │ 👁️ [0:12-0:18] Visual 中风险   │    │
│             │   │    检测到北大校服                │    │
│             │   ├─────────────────────────────────┤    │
│             │   │ 🎤 [0:15-0:22] Speech 高风险    │    │
│             │   │    完全是欺骗学生的，应该抵制... │    │
│             │   └─────────────────────────────────┘    │
└─────────────┴───────────────────────────────────────────┘
```

---

## 🎮 交互操作

### 视频播放 → 列表高亮
- 播放视频时，右侧列表自动高亮当前时间对应的事件
- 支持**多事件同时激活**（重叠时段）
- 激活状态：白色背景 + 紫色外发光

### 点击卡片 → 视频跳转
- 点击任意事件卡片，视频精准跳转到该时间点
- 如果是 Visual 卡片，画面同步显示检测框
- 如果是 Speech 卡片，台词内容高亮显示

### 模态筛选器
| 按钮 | 功能 | 用途 |
|------|------|------|
| **全模态** | 显示所有17个事件 | 完整时间线分析 |
| **风险优先** | 只显示中高风险（约12个） | 快速定位案发现场 |
| **纯字幕** | 只显示语音事件（约6个） | 传统字幕阅读模式 |

---

## 🔍 典型使用场景

### 场景1：快速审查高风险片段
1. 点击"风险优先"筛选器
2. 浏览红色/橙色边框的卡片
3. 点击感兴趣的卡片跳转查看

### 场景2：验证"哑剧漏洞"修复
1. 拖动视频到 24秒（横幅时段）
2. 确认右侧高亮 **Visual卡片**（检测到横幅标语）
3. 确认画面显示**检测框**
4. 验证此时段无语音卡片（纯视觉风险被正确记录）

### 场景3：追踪情绪变化
1. 点击"纯字幕"筛选器
2. 观察 Speech 卡片的情绪标签：平静 → 愤怒 → 紧张 → 平静
3. 点击"愤怒"情绪的卡片查看具体内容

### 场景4：检测框溯源
1. 播放视频，观察画面上的检测框
2. 查看右侧列表中同时激活的 Visual 卡片
3. 验证每个检测框都有对应的卡片记录

---

## 📝 数据结构示例

### Speech 事件
```typescript
{
  id: 'speech-003',
  modality: 'speech',
  startTime: 15,
  endTime: 22,
  riskLevel: 'high',
  riskScore: 95,
  transcript: '但是学校的这个政策完全是欺骗学生的...',
  keywords: ['欺骗', '抵制', '联合'],
  emotion: {
    label: '愤怒',
    intensity: 0.95,
    bgColor: 'rgba(245, 108, 108, 0.15)',
    textColor: '#f56c6c'
  },
  confidence: 98
}
```

### Visual 事件
```typescript
{
  id: 'visual-003',
  modality: 'visual',
  startTime: 16,
  endTime: 20,
  riskLevel: 'high',
  riskScore: 98,
  detectionType: 'ocr',
  detectionLabel: 'OCR敏感词：[抵制]',
  boundingBox: { x: 15, y: 55, width: 40, height: 12 },
  confidence: 98
}
```

### AudioEffect 事件
```typescript
{
  id: 'audio-002',
  modality: 'audio-effect',
  startTime: 22,
  endTime: 24,
  riskLevel: 'high',
  riskScore: 90,
  effectType: 'scream',
  description: '检测到愤怒咆哮声，音量骤升',
  intensity: 0.95,
  confidence: 92
}
```

---

## 🛠️ 开发者接口

### 添加新事件
编辑 `src/data/mockAnalysisResult.ts`，在 `timelineEvents` 数组中添加：

```typescript
{
  id: 'visual-new',
  modality: 'visual',
  startTime: 30,
  endTime: 35,
  riskLevel: 'medium',
  riskScore: 65,
  detectionType: 'gesture',
  detectionLabel: '检测到指指点点手势',
  boundingBox: { x: 40, y: 50, width: 20, height: 30 },
  confidence: 87
} as VisualEvent
```

### 修改筛选逻辑
编辑 `src/views/Analysis.vue` 中的 `filteredTimelineEvents` 计算属性。

### 自定义卡片样式
编辑 `src/views/Analysis.vue` 中的 `.timeline-event-card` SCSS 样式。

---

## 🐛 常见问题

### Q: 事件列表为空？
**A**: 检查 `mockAnalysisResult.timelineEvents` 是否有数据。打开控制台，应该看到验证报告。

### Q: 检测框不显示？
**A**: 确保 Visual 事件包含 `boundingBox` 字段，且"显示检测框"开关已打开。

### Q: 筛选器无效？
**A**: 检查 `modalityFilter` 响应式变量是否正确更新。

### Q: 卡片点击无响应？
**A**: 确保 `jumpToTime` 方法正确绑定，且视频元素 ref 已挂载。

---

## 📚 相关文档

- **重构报告**：`REFACTOR_TIMELINE_EVENTS.md`
- **测试清单**：`TEST_CHECKLIST.md`
- **数据定义**：`src/data/mockAnalysisResult.ts`
- **组件实现**：`src/views/Analysis.vue`
- **验证工具**：`src/utils/verifyTimelineEvents.ts`

---

## ✅ 快速验证

打开浏览器控制台，应该看到：

```
============================================================
【全模态智能事件流】数据验证报告
============================================================
✅ 验证通过！数据结构完整且正确。

📊 统计数据：
  总事件数: 17
  ├─ Speech: 6
  ├─ Visual: 8 (含检测框: 8)
  └─ AudioEffect: 2

  风险分布:
  ├─ 高风险: 6
  ├─ 中风险: 6
  └─ 低风险: 4

  时间覆盖: 50/50 秒 (100.0%)
============================================================
```

如果看到这个报告，说明重构成功！🎉

---

**现在就开始体验工业级的全模态事件流分析系统吧！**
